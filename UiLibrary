-- UI Library Profissional para Roblox
-- Autor: Grok 4 (gerado por xAI)
-- Data: 24 de Dezembro de 2025

local UILibrary = {}

UILibrary.Theme = {
    PrimaryColor = Color3.fromRGB(0, 122, 255),
    SecondaryColor = Color3.fromRGB(255, 255, 255),
    BackgroundColor = Color3.fromRGB(40, 40, 40),
    TextColor = Color3.fromRGB(255, 255, 255),
    AccentColor = Color3.fromRGB(255, 0, 0),
    Font = Enum.Font.SourceSansBold,
    FontSize = 14,
    BorderSize = 1,
    CornerRadius = UDim.new(0, 5)
}

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local function CreateTween(instance, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(duration or 0.2, easingStyle or Enum.EasingStyle.Quad, easingDirection or Enum.EasingDirection.Out)
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

local function MakeDraggable(frame)
    local dragging = false
    local dragInput
    local dragStart
    local startPos

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    RunService:BindToRenderStep("Drag", Enum.RenderPriority.Input.Value, function()
        if dragging and dragInput then
            local delta = dragInput.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

function UILibrary:CreateWindow(title, size, position)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    screenGui.Name = "UILibraryWindow_" .. title:gsub("%s+", "_")

    local mainFrame = Instance.new("Frame")
    mainFrame.Size = size or UDim2.new(0, 400, 0, 300)
    mainFrame.Position = position or UDim2.new(0.5, -200, 0.5, -150)
    mainFrame.BackgroundColor3 = self.Theme.BackgroundColor
    mainFrame.BorderSizePixel = self.Theme.BorderSize
    mainFrame.BorderColor3 = self.Theme.PrimaryColor
    mainFrame.Parent = screenGui

    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = self.Theme.CornerRadius
    uiCorner.Parent = mainFrame

    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = self.Theme.PrimaryColor
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -60, 1, 0)
    titleLabel.Position = UDim2.new(0, 10, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "Janela"
    titleLabel.TextColor3 = self.Theme.TextColor
    titleLabel.Font = self.Theme.Font
    titleLabel.TextSize = self.Theme.FontSize + 2
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar

    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -30, 0, 0)
    closeButton.BackgroundTransparency = 1
    closeButton.Text = "X"
    closeButton.TextColor3 = self.Theme.TextColor
    closeButton.Font = self.Theme.Font
    closeButton.TextSize = self.Theme.FontSize
    closeButton.Parent = titleBar

    closeButton.MouseButton1Click:Connect(function()
        CreateTween(mainFrame, {Size = UDim2.new(0, 0, 0, 0)}, 0.3)
        task.wait(0.3)
        screenGui:Destroy()
    end)

    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    CreateTween(mainFrame, {Size = size or UDim2.new(0, 400, 0, 300)}, 0.3)

    MakeDraggable(titleBar)

    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 5
    contentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)  -- Inicial
    contentFrame.Parent = mainFrame

    local uiListLayout = Instance.new("UIListLayout")
    uiListLayout.Padding = UDim.new(0, 5)
    uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    uiListLayout.Parent = contentFrame

    -- Atualização automática do CanvasSize
    uiListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        contentFrame.CanvasSize = UDim2.new(0, 0, 0, uiListLayout.AbsoluteContentSize.Y + 10)
    end)

    local windowObject = {
        Content = contentFrame,
        -- AddButton, AddLabel, etc. sem as linhas de CanvasSize no final!
        AddButton = function(self, text, callback)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, -10, 0, 30)
            button.BackgroundColor3 = self.Theme.SecondaryColor
            button.Text = text or "Botão"
            button.TextColor3 = self.Theme.TextColor
            button.Font = self.Theme.Font
            button.TextSize = self.Theme.FontSize
            button.Parent = self.Content

            local uiCornerBtn = Instance.new("UICorner")
            uiCornerBtn.CornerRadius = self.Theme.CornerRadius
            uiCornerBtn.Parent = button

            button.MouseButton1Click:Connect(callback or function() end)
            button.MouseEnter:Connect(function()
                CreateTween(button, {BackgroundColor3 = self.Theme.AccentColor})
            end)
            button.MouseLeave:Connect(function()
                CreateTween(button, {BackgroundColor3 = self.Theme.SecondaryColor})
            end)
            -- Sem CanvasSize aqui!
        end,
        -- Repita para os outros AddLabel, AddToggle, AddSlider, AddDropdown (sem a linha CanvasSize no final)
        -- (cole o resto igual ao seu, só removendo essa linha)
    }

    return windowObject
end

function UILibrary:SetTheme(newTheme)
    for key, value in pairs(newTheme) do
        self.Theme[key] = value
    end
end

return UILibrary
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -30, 0, 0)
    closeButton.BackgroundTransparency = 1
    closeButton.Text = "X"
    closeButton.TextColor3 = self.Theme.TextColor
    closeButton.Font = self.Theme.Font
    closeButton.TextSize = self.Theme.FontSize
    closeButton.Parent = titleBar

    closeButton.MouseButton1Click:Connect(function()
        CreateTween(mainFrame, {Size = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
        wait(0.3)
        screenGui:Destroy()
    end)

    -- Animação de Abertura
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    CreateTween(mainFrame, {Size = size or UDim2.new(0, 400, 0, 300)}, 0.3)

    MakeDraggable(titleBar)  -- Torna a janela arrastável pela barra de título

    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 5
    contentFrame.Parent = mainFrame

    local uiListLayout = Instance.new("UIListLayout")
    uiListLayout.Padding = UDim.new(0, 5)
    uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    uiListLayout.Parent = contentFrame
    
    uiListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    contentFrame.CanvasSize = UDim2.new(0, 0, 0, uiListLayout.AbsoluteContentSize.Y + 10)  -- +10 pra margem extra
end)

    -- Retorna um objeto para adicionar elementos
    local windowObject = {
        Content = contentFrame,
        AddButton = function(self, text, callback)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, -10, 0, 30)
            button.BackgroundColor3 = self.Theme.SecondaryColor
            button.Text = text or "Botão"
            button.TextColor3 = self.Theme.TextColor
            button.Font = self.Theme.Font
            button.TextSize = self.Theme.FontSize
            button.Parent = self.Content

            local uiCornerBtn = Instance.new("UICorner")
            uiCornerBtn.CornerRadius = self.Theme.CornerRadius
            uiCornerBtn.Parent = button

            button.MouseButton1Click:Connect(callback or function() end)
            button.MouseEnter:Connect(function()
                CreateTween(button, {BackgroundColor3 = self.Theme.AccentColor})
            end)
            button.MouseLeave:Connect(function()
                CreateTween(button, {BackgroundColor3 = self.Theme.SecondaryColor})
            end)

        end,
        AddLabel = function(self, text)
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -10, 0, 20)
            label.BackgroundTransparency = 1
            label.Text = text or "Label"
            label.TextColor3 = self.Theme.TextColor
            label.Font = self.Theme.Font
            label.TextSize = self.Theme.FontSize
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = self.Content

            
        end,
        AddToggle = function(self, text, default, callback)
            local toggleFrame = Instance.new("Frame")
            toggleFrame.Size = UDim2.new(1, -10, 0, 30)
            toggleFrame.BackgroundTransparency = 1
            toggleFrame.Parent = self.Content

            local toggleLabel = Instance.new("TextLabel")
            toggleLabel.Size = UDim2.new(1, -50, 1, 0)
            toggleLabel.BackgroundTransparency = 1
            toggleLabel.Text = text or "Toggle"
            toggleLabel.TextColor3 = self.Theme.TextColor
            toggleLabel.Font = self.Theme.Font
            toggleLabel.TextSize = self.Theme.FontSize
            toggleLabel.TextXAlignment = Enum.TextXAlignment.Left
            toggleLabel.Parent = toggleFrame

            local toggleButton = Instance.new("TextButton")
            toggleButton.Size = UDim2.new(0, 40, 0, 20)
            toggleButton.Position = UDim2.new(1, -40, 0.5, -10)
            toggleButton.BackgroundColor3 = default and self.Theme.PrimaryColor or self.Theme.BackgroundColor
            toggleButton.Text = ""
            toggleButton.Parent = toggleFrame

            local uiCornerToggle = Instance.new("UICorner")
            uiCornerToggle.CornerRadius = UDim.new(0, 10)
            uiCornerToggle.Parent = toggleButton

            local toggled = default or false
            toggleButton.MouseButton1Click:Connect(function()
                toggled = not toggled
                CreateTween(toggleButton, {BackgroundColor3 = toggled and self.Theme.PrimaryColor or self.Theme.BackgroundColor})
                if callback then callback(toggled) end
            end)

            
        end,
        AddSlider = function(self, text, min, max, default, callback)
            local sliderFrame = Instance.new("Frame")
            sliderFrame.Size = UDim2.new(1, -10, 0, 40)
            sliderFrame.BackgroundTransparency = 1
            sliderFrame.Parent = self.Content

            local sliderLabel = Instance.new("TextLabel")
            sliderLabel.Size = UDim2.new(1, 0, 0, 20)
            sliderLabel.BackgroundTransparency = 1
            sliderLabel.Text = text or "Slider: " .. default
            sliderLabel.TextColor3 = self.Theme.TextColor
            sliderLabel.Font = self.Theme.Font
            sliderLabel.TextSize = self.Theme.FontSize
            sliderLabel.TextXAlignment = Enum.TextXAlignment.Left
            sliderLabel.Parent = sliderFrame

            local sliderBar = Instance.new("Frame")
            sliderBar.Size = UDim2.new(1, 0, 0, 5)
            sliderBar.Position = UDim2.new(0, 0, 1, -10)
            sliderBar.BackgroundColor3 = self.Theme.SecondaryColor
            sliderBar.Parent = sliderFrame

            local uiCornerSlider = Instance.new("UICorner")
            uiCornerSlider.CornerRadius = UDim.new(0, 3)
            uiCornerSlider.Parent = sliderBar

            local fill = Instance.new("Frame")
            fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
            fill.BackgroundColor3 = self.Theme.PrimaryColor
            fill.Parent = sliderBar

            local uiCornerFill = Instance.new("UICorner")
            uiCornerFill.CornerRadius = UDim.new(0, 3)
            uiCornerFill.Parent = fill

            local dragging = false
            sliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                end
            end)

            sliderBar.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local relativeX = math.clamp((input.Position.X - sliderBar.AbsolutePosition.X) / sliderBar.AbsoluteSize.X, 0, 1)
                    local value = min + (max - min) * relativeX
                    value = math.round(value)
                    fill.Size = UDim2.new(relativeX, 0, 1, 0)
                    sliderLabel.Text = text .. ": " .. value
                    if callback then callback(value) end
                end
            end)

            
        end,
        AddDropdown = function(self, text, options, default, callback)
            local dropdownFrame = Instance.new("Frame")
            dropdownFrame.Size = UDim2.new(1, -10, 0, 30)
            dropdownFrame.BackgroundTransparency = 1
            dropdownFrame.Parent = self.Content

            local dropdownButton = Instance.new("TextButton")
            dropdownButton.Size = UDim2.new(1, 0, 1, 0)
            dropdownButton.BackgroundColor3 = self.Theme.SecondaryColor
            dropdownButton.Text = default or options[1] or "Selecionar"
            dropdownButton.TextColor3 = self.Theme.TextColor
            dropdownButton.Font = self.Theme.Font
            dropdownButton.TextSize = self.Theme.FontSize
            dropdownButton.Parent = dropdownFrame

            local uiCornerDrop = Instance.new("UICorner")
            uiCornerDrop.CornerRadius = self.Theme.CornerRadius
            uiCornerDrop.Parent = dropdownButton

            local expanded = false
            local optionsFrame = Instance.new("Frame")
            optionsFrame.Size = UDim2.new(1, 0, 0, 0)
            optionsFrame.Position = UDim2.new(0, 0, 1, 0)
            optionsFrame.BackgroundColor3 = self.Theme.BackgroundColor
            optionsFrame.Visible = false
            optionsFrame.Parent = dropdownFrame

            local uiListOptions = Instance.new("UIListLayout")
            uiListOptions.Padding = UDim.new(0, 2)
            uiListOptions.Parent = optionsFrame

            for _, option in ipairs(options or {}) do
                local optButton = Instance.new("TextButton")
                optButton.Size = UDim2.new(1, 0, 0, 25)
                optButton.BackgroundColor3 = self.Theme.SecondaryColor
                optButton.Text = option
                optButton.TextColor3 = self.Theme.TextColor
                optButton.Font = self.Theme.Font
                optButton.TextSize = self.Theme.FontSize
                optButton.Parent = optionsFrame

                optButton.MouseButton1Click:Connect(function()
                    dropdownButton.Text = option
                    expanded = false
                    optionsFrame.Visible = false
                    if callback then callback(option) end
                end)
            end

            dropdownButton.MouseButton1Click:Connect(function()
                expanded = not expanded
                optionsFrame.Visible = expanded
                CreateTween(optionsFrame, {Size = expanded and UDim2.new(1, 0, 0, #options * 25 + (#options - 1) * 2) or UDim2.new(1, 0, 0, 0)})
            end)

            
        end
    }

    return windowObject
end

-- Função para Alterar o Tema Global
function UILibrary:SetTheme(newTheme)
    for key, value in pairs(newTheme) do
        self.Theme[key] = value
    end
end

return UILibrary

